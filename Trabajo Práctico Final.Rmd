---
title: "Trabajo Práctico Final"
author: "Kihara, Marco & Soubie"
date: "29/8/2021"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

# **Trabajo Práctico Final**

#### A LA INTRO HABRÏA QUE DARLE UNA MAYOR NARRATIVA Y ORDENAR UN POCO MEJOR LOS OBJETIVOS DEL TRABAJO

El cambio climático es uno de los desafíos más urgentes que enfrenta la humanidad. Se espera que en los próximos 15 años, el incremento de la temperatura media mundial por encima de los 1,5ºC. lleve al aumento en la priodicidad e intensidad de los fenómenos climáticos extremos, con grandes consecuencias para la sociedad (y, particularmente, para los sectores más vulnerables), y ponga en duda varios de los avances económicos y sociales logrados hasta el momento. En este marco, es necesario promover una transición hacia un modelo de desarrollo más sostenible y fomentar aquellas iniciativas que conlleven a un uso más racional de los recursos.

En el siguiente trabajo haremos especial foco en el sector turístico nacional. En la última década, esta industria ha realizado sus primeros pasos hacia la incorporación de nuevas tecnologías y procesos ambientalmente sostenibles. Pese a ello, si bien el sector turistico es un sector con un amplio potencial "verde", no existen grandes precisiones sobre cuál es el estado de la cuestión actual.

Con ello en vista, a partir de un análisis de establecimientos certificados con las directrices ambientales, nos propondremos responder: *A* B \*C

Para ordenar el análisis, dividiremos nuestro trabajo en partes.


## 1º PARTE: Directrices de calidad ambiental

```{r include=FALSE}
library(tidyverse)
library(readxl)
library(sf)
options (scipen = 100)
```

Para la primera parte del proyecto trabajaremos sobre el dataset de organizaciones distinguidas del Sistema Argentino de Calidad Turística (SACT) perteneciente al Ministerio de Turismo y Deporte de la Nación, disponible en <http://datos.yvera.gob.ar/>.

```{r}
certificaciones <- read_xls("dato/Organizaciones certificadas.xls")
```

Veamos rapidamente nuestros datos:

```{r}
str(certificaciones)
```

En un primer vistazo, podemos advertir varias cuestiones de nuestro dataset: 
  + Nuestro dataset cuenta con 3176 casos y 18 variables 
  + Los nombres de las variables no necesitan ser limpiados (de momento) 
  + Los casos listados difieren según rubro, subrubro, programa, subprograma, provincia y ciudad, sólo por nombrar algunas variables.

A partir de aquí, analicemos con mayor profundidad nuestro dataset y veamos si es necesario realizar modificaciones al mismo.

Primero, empecemos por ver la cantidad de etiquetas que hay. Como dijimos anteriormente, el actual dataset contiene información sobre las organizaciones turisticas certificadas por el Estado Nacional en diversas materias que hacen a la calidad del servicio que brindan. Veamos cuáles son las que más se repiten:

```{r}
certificaciones %>% 
  group_by(programa) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Agrupemos algunas categorías:

```{r}
certificaciones <- certificaciones %>% 
  mutate(programa = recode(programa,
                           "ISO 9001"="ISO",
                           "ISO 14785" = "ISO",
                           "Reconocimiento Norma ISO" = "ISO",
                           "Programa de Excelencia en Gestión" = "Club de Excelencia",
                           '\"Sistema de Gestión, alineado a las bases del Premio  Nacional a la Calidad\"' = "Premio Nacional a la Calidad"))
```

Miremos el caso del programa "Sello de Calidad" con mayor detenimiento:

```{r}
certificaciones %>% 
  filter(programa=="Sello de Calidad") %>% 
  group_by(subprograma) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Todas las etiquetas corresponden al sello CocinaAR. Por lo tanto, vamos a cambiar el nombre del programa:

```{r}
certificaciones <- certificaciones %>% 
  mutate(programa = recode(programa,"Sello de Calidad"="Sello CocinAR"))
```

Grafiquemos

```{r, fig.height=7, fig.width=15}
programas <- certificaciones %>% 
  group_by(programa) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N))


ggplot() +
  geom_col(data = programas, aes(x=N, y=reorder(programa, N), fill=programa))+
  geom_text(data = programas, aes(x=N+20, y=reorder(programa, N), label=as.integer(N)), size=3)+
  scale_fill_brewer(type = "qual")+
  scale_x_continuous(limits = c(0, 1200),
                     breaks = seq(0, 1200, 200))+
  labs(title="Cantidad de organizaciones certificadas por programas",
       caption="Fuente: Sistema Argentino de Calidad Turística",
       x="Cantidad",
       y="Programas",
       fill="Programas")+
  theme_minimal()
```

### ESCRIBIR CONCLUSIÖN SOBRE GRAPH. (MAX & MIN)

Agreguemos un mayor nivel de profundidad a nuestro análisis de las certificaciones. Veamos los subprogrmas. 

```{r}
certificaciones %>% 
  group_by(programa,subprograma) %>% 
  summarise(N=n()) %>% 
  arrange(programa,desc(N)) %>% 
  print(n=Inf)
```

Como podemos observar, son numerosas las etiquetas que existen. Sin embargo, en este trabajo sólo nos centraremos en aquellas certificaciones que validan una gestión ambiental sostenible: las **Directrices de gestión ambiental** y las **ISO 14001**.

(*ACLARACIÓN: Existen otras etiquetas que contemplan cuestiones de sostenibilidad. Sin embargo, aquí nos ocuparemos de aquellas que son exlcusivas de la temática. Para más info, ver <https://www.argentina.gob.ar/turismo/sistema-argentino-de-calidad-turistica/programas>*)

Ahora, veamos cuál es el rubro más certificado:

```{r}
certificaciones %>% 
  group_by(rubro) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Vemos que es necesario realizar una recodificación de algunos de nuestros casos. Para ello:

```{r}
certificaciones <- certificaciones %>% #HAY QUE METERLE MUCHA MANO A LOS RUBROS Y LOS SUBRUBROS
  mutate(rubro = case_when(
    rubro=="Agencia de viajes" ~ "Agencia de Viajes",
    rubro=="Actividad recreativas y deportivas" ~ "Actividades recreativas y deportivas",
    rubro=="Actividades recreativas y de ocio" ~ "Actividades recreativas y deportivas",
    rubro=="Turismo Aventura" ~ "Actividades recreativas y deportivas",
    rubro=="Otros Servicios" ~ "Otros servicios",
    TRUE ~ rubro))
```

Grafiquemos

```{r, fig.height=7, fig.width=15}
rubro <- certificaciones %>% 
  group_by(rubro) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N))


ggplot() +
  geom_col(data = rubro, aes(x=N, y=reorder(rubro, N), fill=rubro))+
  geom_text(data = rubro, aes(x=N+20, y=reorder(rubro, N), label=as.integer(N)), size=3)+
  labs(title="Cantidad de organizaciones certificadas por rubro",
       caption="Fuente: Sistema Argentino de Calidad Turística",
       x="Cantidad",
       y="Rubro",
       fill="Rubro")+
  theme_minimal()
```

**Alojamiento**, seguido, aunque por bastante diferencia, de **Gastronomía** y **Agencia de viaje** son los rubros más frecuentes de nuestra tabla.

Por último, veamos la distribución geográfica de nuestras iniciativas.

```{r}
certificaciones %>% 
  group_by(pais) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Curiosamente, en el dataset aparecen iniciativas de otras naciones de la región. A los fines de este trabajo, sólo nos concentraremos en aquellas que se encuentran al interior de nuestro país.

```{r}
certificaciones %>% 
  filter(pais=="Argentina") %>% 
  group_by(provincia) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Grafiquemos

```{r, fig.height=7, fig.width=15}
provincias <- certificaciones %>%
  filter(pais=="Argentina") %>% 
  group_by(provincia) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N))


ggplot() +
  geom_col(data = provincias, aes(x=N, y=reorder(provincia, N), fill=provincia))+
  geom_text(data = provincias, aes(x=N+10, y=reorder(provincia, N), label=as.integer(N)), size=3)+
  scale_x_continuous(limits = c(0, 320),
                     breaks = seq(0, 320, 40))+
  labs(title="Cantidad de organizaciones certificadas por provincia",
       caption="Fuente: Sistema Argentino de Calidad Turística",
       x="Cantidad",
       y="Provincia",
       fill="Provincia")+
  theme_minimal()
```

Podemos ver que todas las provincias del país cuentan con al menos una organización certificada en el Sistema Argentino de Calidad Turística. En este contexto, **Buenos Aires** es la provincia que cuenta con el mayor número de certificaciones (306), seguida de **Mendoza** (298), y que **La Pampa** (3) y **Formosa** (7), en ese orden, son las que menos.

```{r}
certificaciones %>% 
  filter(pais=="Argentina") %>% 
  group_by(ciudad) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

En cuanto a las ciudades, la **Ciudad Autónoma de Buenos Aires** (201) y **Bariloche** (120), respectivamente, son las ciudades que cuentan con el mayor número de certificaciones.

Para finalizar con esta sección, filtremos nuestro dataset por los emprendimientos del país que cuentan con las certificaciones ambientales anteriormente mencionadas.

```{r}
ambientales <- certificaciones %>% 
  filter(pais=="Argentina",
         subprograma=="Directrices de Gestión Ambiental" | grepl('14001', subprograma))
```

```{r}
str(ambientales)
```

Podemos ver que nuestro dataset se redujo aproximadamente 8 veces (398 casos en total). En la próxima sección, haremos un análisis más exhaustivo de nuestros casos.

## 2º PARTE: Diagnóstico

Repitamos el análisis que hicimos anteriormente, pero esta vez sólo aplicado a aquellos establecimientos nacionales que cuentan con las **Directrices de gestión ambiental** y las **ISO 14001**.

Veamos cuál es el rubro con más certificaciones ambientales:

```{r}
ambientales %>% 
  group_by(rubro) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Dentro de las entidades certificadas, aquellas correspondientes con el nombre **"Alojamiento"** representan la mayoría (casi el 50% de las certificadas). Veamos a que subcategoría pertencen:

##PODEMOS METER GRAFIQUITO

```{r}
ambientales %>% 
  filter(rubro=="Alojamiento") %>% 
  group_by(subrubro) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Dentro de la categoría "Alojamiento", las **"Cabañas"** (43) son el tipo mayoritario, rondando el 20% de los alojamientos certificados. No obstante, hay que reconocer que la categoría "Hotel" se encuentra dividida en varias subcategorías. ¿Qué sucedería si las agrupamos?

```{r}
ambientales %>% 
  filter(rubro=="Alojamiento") %>% 
  mutate(subrubro=if_else(grepl('Hotel', subrubro), "Hotel", subrubro)) %>%
  group_by(subrubro) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Si recodificamos las variables, veremos que los **hoteles** son el tipo de alojamiento mayoritario (72 casos), lo equivalente a aproximadamente el 36% de la muestra.

Veamos ahora la distribucón geográfica de nuestros casos certificados.

```{r}
ambientales %>% 
  group_by(provincia) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Curiosamente, podemos ver que la **CABA** destronó a Buenos Aires como el distrito con mayores certificaciones. También interesante, vemos que **no todas las provincias del país cuentan con emprendimientos con certificaciones ambientales**, como La Pampa y Formosa.

```{r}
ambientales %>% 
  group_by(ciudad) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

Al hacer foco en las ciudades, **CABA** y **Bariloche** continuan siendo las ciudades con mayores certificaciones, aunque en una magnitud mucho menor que contando la totalidad de las certificaciones. De hecho, si lo comparamos con los datos observados anteriormente, vemos que las certifiaciones ambientales son sólo un 30% de las certificaciones de CABA, y un 15% de las de Bariloche.

Otro dato interesante es que el número de ciudades se redujo considerablemente. En este marco, podemos afirmar que 321 ciudades cuentan con al menos un emprendimiento certificado por alguna buena práctica por el Ministerio de Turismo. Sin embargo, sólo 65 lo hacen por contar con un emprendimiento que contenga una insignia ambiental.

Ahora bien, también resulta interesante analizar los años en los que las entidades obtuvieron sus certificados.

```{r}
library(lubridate)
```

```{r}
class(ambientales$fecha_distincion)
```

```{r}
ambientales <- ambientales %>% 
  mutate(fecha_distincion=ymd(fecha_distincion))
```

```{r}
class(ambientales$fecha_distincion)
```

```{r}
ambientales <- ambientales %>% 
  mutate(mes_distincion=month(fecha_distincion, label = TRUE)) %>% 
  mutate(ano_distincion=year(fecha_distincion))
```

```{r}
ambientales %>% 
  group_by(ano_distincion) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

A partir de la información previa se evidencia que la mayoría de las distinciones fueron otorgadas en el año 2017. Por el contrario, dos años antes (año 2015) se registra la menor cantidad de distinciones.

Se podría pensar que, a medida que pasa el tiempo, cada año debería ser mayor la cantidad de entidades que reciben distinciones, ya sea porque aumenta el compromiso / la conciencia para con el medioambiente, ya sea porque se populariza la existencia de las distinciones, etc. Sin embargo, esta idea se refuta cuando se observa que del 2017 al 2018 y del 2018 al 2019 hubo reducciones considerables en la cantidad de entidades reconocidas con dicha certificación.

Ahora se considerará este misma análisis pero para las dos ciudades que concentran la mayor cantidad de distinciones: CABA y Bariloche.

```{r}
ambientales_ano_ciud <- ambientales %>% 
  filter(ciudad %in% c("Ciudad Autonoma De Buenos Aires", "San Carlos De Bariloche")) %>% 
  group_by(ano_distincion, ciudad) %>% 
  summarise(N=n()) %>% 
  arrange(desc(N)) %>% 
  print(n=Inf)
```

A partir de esta información se observa que, a pesar de que las dos ciudades sean las que poseen mayor cantidad de entidades certificadas, cada una de ellas tuvo su momento de "apogeo" de las distinciones. En el caso de la Ciudad de Buenos Aires fue en el año 2019, cuando entregó 17 distinciones; mientras que en San Carlos de Bariloche (Río Negro) fue en el año 2017, reforzando la tendencia previamente observada a nivel nacional.

Por otro lado, además de analizar el año de certificaciones por Ciudades, evaluaremos el año de certificaciones según los rubros, para poder detectar si durante algún año en particular hubo un rubro que obtuvo mayores distinciones que otro. 

```{r}
ambientales_ano_rubro <- ambientales %>% 
  group_by(ano_distincion, rubro) %>% 
  summarise(N=n())
```

```{r}
ambientales_ano_rubro_2 <- ambientales_ano_rubro %>% 
  pivot_wider(names_from = ano_distincion, values_from = N)
```

```{r}
ambientales_ano_rubro_2 %>% 
  select(-9) %>% 
  apply(2, which.max)
```

A partir de la operación anterior se puede observar que para todos los años analizados (excepto para el 2019), el rubro que recibió mayor cantidad de distinciones fue el de Alojamiento (4to en la lista). En el caso del año 2019, el rubro que obtuvo mayor cantidad de distinciones fue el de Balnearios. 

Ahora bien, esta comparación en términos absolutos resulta un tanto injusta para aquellos rubros que poseen pocas certificaciones totales. Por lo tanto, ahora analizaremos la misma tabla que antes pero considerando los porcentajes de certificaciones recibidas por año por cada rubro.


```{r}
ambientales_ano_rubro_100 <- ambientales_ano_rubro %>% 
  pivot_wider(names_from = rubro, values_from = N)
```


```{r}
calcular_pct <- function(data){
  round(data/(sum(data))*100,1)}
```

Para este análisis no consideraremos aquellos rubros que poseen valores nulos para todos los años excepto para uno, ya que para ese año tendrán un valor igual al 100%. Por este motivo, las columnas que no tendremos en cuenta son: 

- Oficina de Informes

- Eventos

- Producción Olivícola

```{r}
ambientales_ano_rubro_100 <- ambientales_ano_rubro_100 %>% 
  select(-12) %>% 
  select(-(16:17))
```

```{r}
class(ambientales_ano_rubro_100$`Actividades recreativas y deportivas`)
```
```{r}
class(ambientales_ano_rubro_100$ano_distincion)
```


```{r}
library(janitor)
```


```{r}
ambientales_ano_rubro_100 <- ambientales_ano_rubro_100 %>% 
  replace(is.na(.),0) %>% 
  filter(!ano_distincion==0) %>% 
  clean_names()
```


ACÁ INTENTÉ HACER LA FUNCION, PARA PODER SACAR LOS PORCENTAJES Y NO FUNCIONÓ. SI ALGUIEN SABE QUÉ ME ESTÁ FALTANDO LA RETOCAMOS Y SINO, LA ELIMINAMOS, NO HAY PROBLEMA; PERO QUERÍA PROBAR AL MENOS. 

```{r}
ambientales_ano_rubro_100_PRUEBA <- ambientales_ano_rubro_100 %>% 
  as.character(ano_distincion) %>% 
  transmute(ano_distincion, act_cul=(calcular_pct(data= actividades_culturales))) %>% 
  transmute(ano_distincion, act_ryd=(calcular_pct(data = as.numeric(actividades_recreativas_y_deportivas)))) %>% 
  transmute(ano_distincion, ag_viajes=(calcular_pct(data = as.numeric(`Agencia de Viajes`)))) %>% 
  transmute(ano_distincion, aloj=(calcular_pct(data = as.numeric(`Alojamiento`)))) %>% 
  transmute(ano_distincion, area_nat=(calcular_pct(data = as.numeric(`Area Natural Protegida`)))) %>% 
  transmute(ano_distincion, balne=(calcular_pct(data = as.numeric(`Balneario`)))) %>% 
  transmute(ano_distincion, com_tur=(calcular_pct(data = as.numeric(`Comercio Turistico`)))) %>% 
  transmute(ano_distincion, eno=(calcular_pct(data=as.numeric(`Enoturismo`)))) %>% 
  transmute(ano_distincion, gastro=(calcular_pct(data = as.numeric(`Gastronomía`)))) %>% 
  transmute(ano_distincion, org_pub=(calcular_pct(data = as.numeric(`Organismo Público`)))) %>% 
  transmute(ano_distincion, transp_tur=(calcular_pct(data = as.numeric(`Transporte turístico`)))) %>% 
  transmute(ano_distincion, asoc=(calcular_pct(data=as.numeric(`Asociación`)))) %>% 
  transmute(ano_distincion, conce=(calcular_pct(data = as.numeric(`Concesionaria`)))) %>% 
  transmute(ano_distincion, emp_seryes=(calcular_pct(data = as.numeric(`Empresa de servicios y espectáculos`))))
```

Y ME FALTA HACER LA PARTE DE CANTIDAD DE DÍAS DESDE QUE CERTIFICARON




